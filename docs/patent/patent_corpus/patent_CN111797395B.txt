## Patent Reference

- Title: Malicious code visualization and variant detection method, device, equipment and storage medium
- URL: https://patents.google.com/patent/CN111797395B/en

### Abstract

Abstract The invention discloses a malicious code visualization and variant detection method, a device, equipment and a storage medium, wherein the malicious code visualization and variant detection method comprises the following steps: converting malicious codes to be detected into one-dimensional time sequence signals by acquiring the malicious codes; performing singular spectrum transformation on the one-dimensional time sequence signal to obtain a singular transformation spectrum corresponding to the malicious code, and outputting and displaying the singular transformation spectrum; inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variety detection to obtain family information to which the malicious code belongs, wherein the preset malicious code classifier is obtained based on singular transformation spectrum training of a malicious code sample. The method visually displays the singular transformation spectrum corresponding to the malicious code, thereby being convenient and quick for positioning the malicious code and improving the efficiency and accuracy of detecting the variety of the malicious code.

### Description

Description Translated from Chinese 恶意代码可视化及变种检测方法、装置、设备及存储介质Malicious code visualization and variant detection method, device, equipment and storage medium 技术领域technical field 本发明涉及信息安全技术领域，尤其涉及一种恶意代码可视化及变种检测方法、装置、设备及存储介质。The present invention relates to the technical field of information security, in particular to a malicious code visualization and variant detection method, device, equipment and storage medium. 背景技术Background technique 据统计目前国际上有数万种病毒，而变种病毒却有成百上千万，恶意代码变种率急剧上升。According to statistics, there are currently tens of thousands of viruses in the world, but there are millions of variant viruses, and the rate of malicious code variants has risen sharply. 目前恶意代码可视化及变种检测方法从所采用的特征角度来看，主要有以下两种：基于静态语义特征的方法和基于图像纹理特征的方法。基于静态语义特征的方法主要是从恶意代码中提取操作码序列、应用程序接口函数调用序列、控制流、数据流和程序依赖关系等进行分析。这种方法对程序代码的分析依赖于反汇编代码的精度，且通常会涉及判断子图同构的问题，而判断子图同构问题是NP完全（Non-deterministic PolynomialComplete）问题，判断过程耗时较长；基于图像纹理特征的方法需要从图像这种二维数据提取特征，特征提取过程比较复杂，运行效率也比较低。From the point of view of the features adopted, the current malicious code visualization and variant detection methods mainly include the following two methods: methods based on static semantic features and methods based on image texture features. The method based on static semantic features mainly extracts opcode sequence, application program interface function call sequence, control flow, data flow and program dependency from malicious code for analysis. The analysis of the program code by this method depends on the accuracy of the disassembly code, and usually involves the problem of judging the isomorphism of the subgraph, and the problem of judging the isomorphism of the subgraph is an NP-complete (Non-deterministic PolynomialComplete) problem, and the judgment process is time-consuming Longer; the method based on image texture features needs to extract features from two-dimensional data such as images, the feature extraction process is more complicated, and the operating efficiency is relatively low. 发明内容Contents of the invention 本发明的主要目的在于提供一种恶意代码可视化及变种检测方法，旨在解决现有的恶意代码都是代码化显示，用户查看不方便恶意代码定位效率低，且变种检测效率低下的技术问题。The main purpose of the present invention is to provide a malicious code visualization and variant detection method, aiming to solve the existing technical problems that the existing malicious codes are coded display, inconvenient for users to locate malicious codes, and low efficiency of variant detection. 为实现上述目的，本发明提供一种恶意代码可视化及变种检测方法，所述恶意代码可视化及变种检测方法包括：In order to achieve the above object, the present invention provides a malicious code visualization and variant detection method, the malicious code visualization and variant detection method comprising: 获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号；Obtaining the malicious code to be detected, and converting the malicious code into a one-dimensional time series signal; 将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；performing singular spectrum transformation on the one-dimensional time series signal, obtaining the singular transformation spectrum corresponding to the malicious code and outputting it for display; 将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息，其中，所述预设恶意代码分类器是基于恶意代码样本的奇异变换谱训练获得。Inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining family information to which the malicious code belongs, wherein the preset malicious code classifier is based on the singular transformation of malicious code samples Spectrum training is obtained. 可选地，所述获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号的步骤，包括：Optionally, the steps of acquiring the malicious code to be detected and converting the malicious code into a one-dimensional time series signal include: 获取待检测的恶意代码，及所述恶意代码的二进制可执行文件，将所述二进制可执行文件转换为一维整数数组；Obtain the malicious code to be detected, and the binary executable file of the malicious code, and convert the binary executable file into a one-dimensional integer array; 将所述一维整数数组按照预设采样规则进行下采样，获得一维时间序列信号。The one-dimensional integer array is down-sampled according to a preset sampling rule to obtain a one-dimensional time series signal. 可选地，所述将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示的步骤，包括：Optionally, the step of performing singular spectrum transformation on the one-dimensional time series signal to obtain the singular transformation spectrum corresponding to the malicious code and outputting and displaying includes: 将所述一维时间序列信号组合形成时间集合，将所述时间集合转化为预设长度的时间子序列；combining the one-dimensional time series signals to form a time set, and converting the time set into a time subsequence of a preset length; 根据所述时间子序列构造轨迹矩阵，根据所述时间子序列构造测试矩阵，根据所述轨迹矩阵和所述测试矩阵确定变化点分数；Constructing a trajectory matrix according to the time subsequence, constructing a test matrix according to the time subsequence, determining a change point score according to the trajectory matrix and the test matrix; 以所述一维时间序列信号中的时刻为横坐标，以所述变化点分数为纵坐标，获得所述恶意代码对应的奇异变换谱并输出显示。Taking the time in the one-dimensional time series signal as the abscissa and the change point score as the ordinate, obtain the singular transformation spectrum corresponding to the malicious code and output it for display. 可选地，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤之前，所述方法包括：Optionally, before the step of inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the family information to which the malicious code belongs, the method includes: 从预设恶意代码文件数据库中抽取恶意代码样本，将各所述恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；extracting malicious code samples from the preset malicious code file database, performing singular spectrum transformation on each of the malicious code samples, and obtaining a singular transformation spectrum corresponding to each of the malicious code samples; 将各所述奇异变换谱划分形成第一训练集与第一测试集；dividing each singular transformation spectrum to form a first training set and a first test set; 通过所述第一训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；Iteratively training the initial classification algorithm through the singular transformation spectrum in the first training set to obtain a malicious code classifier; 通过所述第一测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code classifier is verified through the first test set to obtain a preset malicious code classifier. 可选地，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤，包括：Optionally, the step of inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the family information to which the malicious code belongs includes: 将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码的分类结果；Inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the classification result of the malicious code; 在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；When the classification result is the first category, then output the family information of the malicious code; 在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。When the classification result is the second type, it is determined that the malicious code is listed as a new type of malicious code family and output prompt information. 可选地，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤之前，所述方法包括：Optionally, before the step of inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the family information to which the malicious code belongs, the method includes: 将预设恶意代码文件数据库中的恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；performing singular spectrum transformation on the malicious code samples in the preset malicious code file database to obtain a singular transformation spectrum corresponding to each of the malicious code samples; 从各所述奇异变换谱中提取样本时间序列特征，将各所述样本时间序列特征划分形成第二训练集与第二测试集；extracting sample time series features from each of the singular transformation spectra, and dividing each of the sample time series features to form a second training set and a second test set; 通过所述第二训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；Iteratively training the initial classification algorithm through the singular transformation spectrum in the second training set to obtain a malicious code classifier; 通过所述第二测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code classifier is verified through the second test set to obtain a preset malicious code classifier. 可选地，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤，包括：Optionally, the step of inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the family information to which the malicious code belongs includes: 从所述恶意代码对应的奇异变换谱中提取的待测时间序列特征，将所述待测时间序列特征输入预设恶意代码分类器，获取分类结果；From the time series features to be tested extracted from the singular transformation spectrum corresponding to the malicious code, inputting the time series features to be tested into a preset malicious code classifier to obtain classification results; 在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；When the classification result is the first category, then output the family information of the malicious code; 在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。When the classification result is the second type, it is determined that the malicious code is listed as a new type of malicious code family and output prompt information. 此外，为实现上述目的，本发明还提供一种恶意代码可视化及变种检测装置，所述恶意代码可视化及变种检测装置包括：In addition, in order to achieve the above object, the present invention also provides a malicious code visualization and variant detection device, the malicious code visualization and variant detection device includes: 获取转化模块，用于获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号；Obtaining a transformation module, configured to obtain malicious codes to be detected, and convert the malicious codes into one-dimensional time series signals; 变化谱生成模块，用于将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；A variation spectrum generating module, configured to perform singular spectrum transformation on the one-dimensional time series signal, obtain the singular transformation spectrum corresponding to the malicious code and output and display it; 检测确定模块，用于将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息，其中，所述预设恶意代码分类器是基于恶意代码样本的奇异变换谱训练获得。A detection determination module, configured to input the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtain family information to which the malicious code belongs, wherein the preset malicious code classifier is based on Singular transformation spectrum training of malicious code samples is obtained. 此外，为实现上述目的，本发明还提供一种恶意代码可视化及变种检测设备，所述恶意代码可视化及变种检测设备包括：存储器、处理器及存储在所述存储器上并可在所述处理器上运行的恶意代码可视化及变种检测程序，所述恶意代码可视化及变种检测程序被所述处理器执行时实现如上述的恶意代码可视化及变种检测方法的步骤。In addition, in order to achieve the above object, the present invention also provides a malicious code visualization and variant detection device, the malicious code visualization and variant detection device includes: a memory, a processor and a A malicious code visualization and variant detection program running on the computer, when the malicious code visualization and variant detection program is executed by the processor, the steps of the above-mentioned malicious code visualization and variant detection method are realized. 此外，为实现上述目的，本发明还提供一种存储介质，所述存储介质上存储有恶意代码可视化及变种检测程序，所述恶意代码可视化及变种检测程序被处理器执行时实现如上述的恶意代码可视化及变种检测方法的步骤。In addition, in order to achieve the above object, the present invention also provides a storage medium, on which a malicious code visualization and variant detection program is stored, and when the malicious code visualization and variant detection program is executed by a processor, the above malicious code can be realized. The steps of the code visualization and variant detection method. 本发明提供一种恶意代码可视化及变种检测方法、装置、设备及存储介质。本发明实施例中通过将恶意代码转化为一维时间序列信号，以便获取恶意代码的时间序列信号特征，将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；通过输出恶意代码所对应的奇异变换谱，便于直观感知各个变种的共同之处和细微差异，将恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得恶意代码所属的家族信息，使得恶意代码家族分类更加快速准确，采用本发明的可视化分析方法在进行恶意代码同个家族的样本分析时，能够明显发现各个变种的共同之处和细微差异，使得用户方便理解和掌握该恶意代码家族变种演化进程；与此同时，本发明实施例中的技术方法降低了恶意代码分析人员的专业技术要求，减少了人力资源浪费。The invention provides a malicious code visualization and variant detection method, device, equipment and storage medium. In the embodiment of the present invention, the malicious code is converted into a one-dimensional time series signal in order to obtain the characteristics of the time series signal of the malicious code, and the singular spectrum transformation is performed on the one-dimensional time series signal to obtain the singular transformation spectrum corresponding to the malicious code And output the display; by outputting the singular transformation spectrum corresponding to the malicious code, it is convenient to intuitively perceive the commonality and subtle differences of each variant, input the singular transformation spectrum corresponding to the malicious code to the preset malicious code classifier for variant detection, and obtain malicious The family information to which the code belongs makes the classification of malicious code families faster and more accurate. When the visual analysis method of the present invention is used to analyze the samples of the same family of malicious codes, the commonalities and subtle differences of each variant can be clearly found, making it convenient for users Understanding and mastering the evolution process of the variant of the malicious code family; at the same time, the technical method in the embodiment of the present invention reduces the professional technical requirements of malicious code analysts and reduces the waste of human resources. 附图说明Description of drawings 图1是本发明实施例方案涉及的硬件运行环境的恶意代码可视化及变种检测设备结构示意图；Fig. 1 is a schematic diagram of the malicious code visualization and variant detection equipment of the hardware operating environment involved in the embodiment of the present invention; 图2为本发明恶意代码可视化及变种检测方法第一实施例的流程示意图；Fig. 2 is a schematic flow chart of the first embodiment of the malicious code visualization and variant detection method of the present invention; 图3为本发明恶意代码可视化及变种检测方法一具体实施例中的检测流程示意图；Fig. 3 is a schematic diagram of the detection process in a specific embodiment of the malicious code visualization and variant detection method of the present invention; 图4为本发明恶意代码可视化及变种检测方法一种预设恶意代码分类器的训练方式示意图；Fig. 4 is a schematic diagram of a training method of a preset malicious code classifier of the malicious code visualization and variant detection method of the present invention; 图5为本发明恶意代码可视化及变种检测方法一具体实施例中Malimg恶意代码分类混淆矩阵示意图；Fig. 5 is a schematic diagram of Malimg malicious code classification confusion matrix in a specific embodiment of malicious code visualization and variant detection method of the present invention; 图6为本发明恶意代码可视化及变种检测方法另一种预设恶意代码分类器的训练方式示意图；6 is a schematic diagram of another preset malicious code classifier training method of the malicious code visualization and variant detection method of the present invention; 图7为本发明恶意代码可视化及变种检测方法一具体实施例中Malheur恶意代码分类混淆矩阵示意图。FIG. 7 is a schematic diagram of the confusion matrix of Malheur malicious code classification in a specific embodiment of the malicious code visualization and variant detection method of the present invention. 本发明目的的实现、功能特点及优点将结合实施例，参照附图做进一步说明。The realization of the purpose of the present invention, functional characteristics and advantages will be further described in conjunction with the embodiments and with reference to the accompanying drawings. 具体实施方式Detailed ways 应当理解，此处所描述的具体实施例仅仅用以解释本发明，并不用于限定本发明。It should be understood that the specific embodiments described here are only used to explain the present invention, not to limit the present invention. 如图1所示，图1是本发明实施例方案涉及的硬件运行环境的恶意代码可视化及变种检测设备结构示意图。As shown in FIG. 1 , FIG. 1 is a schematic structural diagram of a malicious code visualization and variant detection device for a hardware operating environment involved in the solution of an embodiment of the present invention. 本发明实施例恶意代码可视化及变种检测设备可以是PC、平板电脑等具有显示功能的恶意代码可视化及变种检测设备。The malicious code visualization and variant detection device in the embodiment of the present invention may be a malicious code visualization and variant detection device with a display function such as a PC or a tablet computer. 如图1所示，该恶意代码可视化及变种检测设备可以包括：处理器1001，例如CPU，通信总线1002，用户接口1003，网络接口1004，存储器1005。其中，通信总线1002用于实现这些组件之间的连接通信。用户接口1003可以包括显示屏（Display）、输入单元比如键盘（Keyboard），可选的用户接口1003还可以包括标准的有线接口、无线接口。网络接口1004可选的可以包括标准的有线接口、无线接口（如WI-FI接口）。存储器1005可以是高速RAM存储器，也可以是稳定的存储器（non-volatile memory），例如磁盘存储器。存储器1005可选的还可以是独立于前述处理器1001的存储设备。As shown in FIG. 1 , the malicious code visualization and variant detection device may include: a processor 1001 , such as a CPU, a communication bus 1002 , a user interface 1003 , a network interface 1004 , and a memory 1005 . Wherein, the communication bus 1002 is used to realize connection and communication between these components. The user interface 1003 may include a display screen (Display) and an input unit such as a keyboard (Keyboard), and the optional user interface 1003 may also include a standard wired interface and a wireless interface. Optionally, the network interface 1004 may include a standard wired interface and a wireless interface (such as a WI-FI interface). The memory 1005 may be a high-speed RAM memory, or a stable memory (non-volatile memory), such as a disk memory. Optionally, the memory 1005 may also be a storage device independent of the aforementioned processor 1001 . 本领域技术人员可以理解，图1中示出的恶意代码可视化及变种检测设备结构并不构成对恶意代码可视化及变种检测设备的限定，可以包括比图示更多或更少的部件，或者组合某些部件，或者不同的部件布置。Those skilled in the art can understand that the structure of the malicious code visualization and variant detection device shown in Figure 1 does not constitute a limitation on the malicious code visualization and variant detection device, and may include more or less components than those shown in the figure, or a combination certain components, or a different arrangement of components. 如图1所示，作为一种存储介质的存储器1005中可以包括操作装置、网络通信模块、用户接口模块以及恶意代码可视化及变种检测程序。As shown in FIG. 1 , the memory 1005 as a storage medium may include an operating device, a network communication module, a user interface module, and malicious code visualization and variant detection programs. 在图1所示的恶意代码可视化及变种检测设备中，网络接口1004主要用于连接后台服务器，与后台服务器进行数据通信；用户接口1003主要用于连接客户端（用户端），与客户端进行数据通信；而处理器1001可以用于调用存储器1005中存储的恶意代码可视化及变种检测程序，并恶意代码可视化及变种检测方法。In the malicious code visualization and variant detection device shown in Figure 1, the network interface 1004 is mainly used to connect to the background server and perform data communication with the background server; the user interface 1003 is mainly used to connect to the client (client) and communicate with the client. Data communication; and the processor 1001 can be used to call the malicious code visualization and variant detection program stored in the memory 1005, and the malicious code visualization and variant detection method. 基于上述硬件结构，提出本发明恶意代码可视化及变种检测方法的各个实施例。Based on the above hardware structure, various embodiments of the malicious code visualization and variant detection method of the present invention are proposed. 据统计目前国际上有数万种病毒，而变种病毒却有成百上千万，恶意代码变种率从2011年的每个家族变种率为5:1，到如今1000:1以上。研究表明绝大多数的新型恶意代码都是由已知的恶意代码变异而得，而这样的变种恶意代码间只有不到2%的代码差异，这给分析恶意代码的安全研究人员提供了变种检测依据，通过检测恶意代码核心模块的相似度来对恶意代码进行变种检测。恶意代码可视化及变种检测已经成为了恶意代码检测的重点和难点。According to statistics, there are currently tens of thousands of viruses in the world, but there are millions of variant viruses. The mutation rate of malicious codes has changed from 5:1 per family in 2011 to more than 1000:1 today. Studies have shown that the vast majority of new malicious codes are mutated from known malicious codes, and such variant malicious codes have less than 2% code difference, which provides security researchers who analyze malicious codes with variant detection. Based on this, the malicious code variant detection is performed by detecting the similarity of the core module of the malicious code. Malicious code visualization and variant detection have become the focus and difficulty of malicious code detection. 目前，恶意代码可视化及变种检测方法从所采用的特征角度来看，主要有以下两种：基于静态语义特征的方法和基于图像纹理特征的方法。基于静态语义特征的方法主要是从恶意代码中提取操作码序列、应用程序接口（API，Application ProgrammingInterface）函数调用序列、控制流、数据流和程序依赖关系等进行分析。这种方法对程序代码的分析依赖于反汇编代码的精度，且通常会涉及判断子图同构的问题，而判断子图同构问题是NP完全（Non-deterministic Polynomial Complete）问题，判断过程耗时较长。基于图像纹理特征的方法）需要从图像这种二维数据提取特征，特征提取过程比较复杂，运行效率也比较低。故上述的种种情况均反映出现有的恶意代码可视化及变种检测方法的效率低下的技术问题。At present, the malicious code visualization and variant detection methods mainly include the following two types from the perspective of the features adopted: the method based on static semantic features and the method based on image texture features. The method based on static semantic features mainly extracts opcode sequences, application programming interface (API, Application Programming Interface) function call sequences, control flow, data flow, and program dependencies from malicious code for analysis. The analysis of the program code by this method depends on the accuracy of the disassembly code, and usually involves the problem of judging the isomorphism of the subgraph, and the problem of judging the isomorphism of the subgraph is an NP-complete (Non-deterministic Polynomial Complete) problem, and the judgment process consumes for a long time. The method based on image texture features) needs to extract features from two-dimensional data such as images. The feature extraction process is relatively complicated and the operating efficiency is relatively low. Therefore, the above-mentioned situations all reflect the technical problem of low efficiency of existing malicious code visualization and variant detection methods. 为解决上述问题，本发明提供一种恶意代码可视化及变种检测方法，即通过将恶意代码转化为一维时间序列信号，以便获取恶意代码的时间序列信号特征，相比提取静态语义特征以及二维图像纹理特征，大大减小了时间开销；通过输出恶意代码所对应的奇异变换谱，便于从视觉上直观感知各个变种的共同之处和细微差异，为理解和掌握该家族变种演化提供了依据；通过基于恶意代码样本对应的奇异变换谱进行分类模型训练，使得恶意代码家族分类更加快速准确。本发明的可视化分析能够采用程序化的方式执行，相比恶意代码静态语义特征的分析，降低了恶意代码分析人员的专业技术要求，从而解决了现有的恶意代码可视化及变种检测方法的效率低下的技术问题。所述恶意代码可视化及变种检测方法应用于装有恶意代码可视化及变种检测装置的恶意代码可视化及变种检测设备。In order to solve the above problems, the present invention provides a malicious code visualization and variant detection method, that is, by converting the malicious code into a one-dimensional time series signal, in order to obtain the time series signal characteristics of the malicious code, compared with extracting static semantic features and two-dimensional The image texture feature greatly reduces the time overhead; by outputting the singular transformation spectrum corresponding to the malicious code, it is convenient to visually perceive the commonalities and subtle differences of each variant, which provides a basis for understanding and mastering the evolution of the family variant; Classification model training based on the singular transformation spectrum corresponding to malicious code samples makes the classification of malicious code families faster and more accurate. The visual analysis of the present invention can be performed in a programmed manner, and compared with the analysis of static semantic features of malicious code, the professional technical requirements of malicious code analysts are reduced, thereby solving the inefficiency of existing malicious code visualization and variant detection methods technical problems. The malicious code visualization and variant detection method is applied to a malicious code visualization and variant detection device equipped with a malicious code visualization and variant detection device. 参照图2，图2为恶意代码可视化及变种检测方法第一实施例的流程示意图。Referring to FIG. 2 , FIG. 2 is a schematic flowchart of a first embodiment of a malicious code visualization and variant detection method. 在本发明恶意代码可视化及变种检测方法第一实施例中，所述恶意代码可视化及变种检测方法包括以下步骤：In the first embodiment of the malicious code visualization and variant detection method of the present invention, the malicious code visualization and variant detection method includes the following steps: 步骤S10，获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号。Step S10, acquiring the malicious code to be detected, and converting the malicious code into a one-dimensional time series signal. 本实施例中的恶意代码可视化及变种检测方法运用与恶意代码可视化及变种检测设备，恶意代码可视化及变种检测设备获取待检测的恶意代码，恶意代码是指故意编制或设置的、对网络或装置会产生威胁或潜在威胁的计算机代码，最常见的恶意代码有计算机病毒、特洛伊木马、计算机蠕虫、后门、逻辑炸弹等，恶意代码通常记录于二进制可执行文件中，恶意代码的获取方式可为用户向恶意代码可视化及变种检测设备导入，或是恶意代码可视化及变种检测设备根据预设程序自动获取等。The malicious code visualization and variant detection method in this embodiment is applied to the malicious code visualization and variant detection equipment. The malicious code visualization and variant detection equipment obtains the malicious code to be detected. Computer codes that generate threats or potential threats. The most common malicious codes include computer viruses, Trojan horses, computer worms, backdoors, logic bombs, etc. Malicious codes are usually recorded in binary executable files. The way to obtain malicious codes can be Import to malicious code visualization and variant detection equipment, or automatically obtain malicious code visualization and variant detection equipment according to preset programs, etc. 恶意代码可视化及变种检测设备在获取到当前需要检测的恶意代码文件时，从恶意代码文件中读取恶意代码数据，并按照预设读取规则，将二进制的恶意代码数据转换成多个一维无符号整数数组。例如，读取规则为，每八位二进制数据读取成一个对应的取值范围在0至255的无符号整数，则可将当前恶意代码文件中所有的二进制恶意代码数据全部转换为对应的一维整数数组。When the malicious code visualization and variant detection device obtains the malicious code file that needs to be detected, it reads the malicious code data from the malicious code file, and converts the binary malicious code data into multiple one-dimensional data according to the preset reading rules. Array of unsigned integers. For example, the reading rule is that every eight-bit binary data is read into a corresponding unsigned integer whose value ranges from 0 to 255, then all the binary malicious code data in the current malicious code file can be converted into a corresponding one dimensional integer array. 恶意代码可视化及变种检测设备将二进制恶意代码数据转换得到的一维整数数组视为一维样值时间序列信号，并按照固定长度或是一定比例进行下采样，即可在一维样值时间序列信号的基础上得到一维时间序列信号。其中，对于一个样值序列间隔几个样值取样一次，这样得到新序列就是原序列的下采样。需要说明的是，恶意代码所对应的一维时间序列可对用户进行显示，以增强恶意代码可视化及变种检测的可视性。Malicious code visualization and variant detection equipment treats the one-dimensional integer array converted from binary malicious code data as a one-dimensional sample time series signal, and performs downsampling according to a fixed length or a certain ratio, so that the one-dimensional sample time series The basis of the signal is to obtain a one-dimensional time series signal. Among them, a sample value sequence is sampled at intervals of several samples, so that the new sequence obtained in this way is the downsampling of the original sequence. It should be noted that the one-dimensional time series corresponding to the malicious code can be displayed to the user, so as to enhance the visibility of malicious code visualization and variant detection. 步骤S20，将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示。Step S20, performing singular spectrum transformation on the one-dimensional time series signal, obtaining the singular transformation spectrum corresponding to the malicious code, and outputting it for display. 恶意代码可视化及变种检测设备将一维时间序列信号进行奇异谱变换（又叫SST，Singular Spectrum Transformation），获得恶意代码对应的奇异变换谱，即，恶意代码可视化及变种检测设备设定一维时间序列信号S的长度为n（），将这个一维时间序列信号/>，记为集合/>，第t个信号定义为第t个时刻，则长度为W的/>的子序列为/>，其中，上标T表示转置，恶意代码可视化及变种检测设备根据子序列构建矩阵，通过比对矩阵的相似度，获得恶意代码对应的奇异变换谱。The malicious code visualization and variant detection equipment performs singular spectrum transformation (also called SST, Singular Spectrum Transformation) on the one-dimensional time series signal to obtain the singular transformation spectrum corresponding to the malicious code, that is, the malicious code visualization and variant detection equipment sets one-dimensional time The length of the sequence signal S is n ( ), this one-dimensional time series signal /> , denoted as a collection /> , the tth signal is defined as the tth moment, then the length is W's /> The subsequence of /> , where the superscript T represents transposition, the malicious code visualization and variant detection equipment constructs a matrix according to the subsequence, and obtains the singular transformation spectrum corresponding to the malicious code by comparing the similarity of the matrix. 如图3所示，恶意代码可视化及变种检测设备在获取到当前需要检测的恶意代码文件时，将此恶意代码二进制可执行文件中的数据按照每8位对应一无符号整数的转换规则进行转换，即可将恶意代码的二进制数据转换为一维整数数组，并将此一维整数数据看作是恶意代码的样本时间序列信号，对其进行下采样，得到恶意代码的时间序列信号，恶意代码可视化及变种检测设备再对恶意代码的时间序列信号进行奇异谱变换获得奇异变换谱并显示出来，以供分析人员进行直观分析。恶意代码可视化及变种检测设备在屏幕上显示当前所检测的恶意代码对应的奇异变换谱，以便用户直观地对当前所检测的恶意代码的奇异谱变换变换谱进行特征分析，分析其同源性。As shown in Figure 3, when the malicious code visualization and variant detection device obtains the malicious code file that needs to be detected currently, it converts the data in the malicious code binary executable file according to the conversion rule that every 8 bits corresponds to an unsigned integer , the binary data of the malicious code can be converted into a one-dimensional integer array, and the one-dimensional integer data can be regarded as the sample time series signal of the malicious code, which is down-sampled to obtain the time series signal of the malicious code, the malicious code The visualization and variant detection equipment performs singular spectrum transformation on the time series signal of malicious code to obtain and display the singular transformation spectrum for intuitive analysis by analysts. Malicious code visualization and variant detection equipment displays the singular transformation spectrum corresponding to the currently detected malicious code on the screen, so that users can intuitively analyze the characteristics of the singular transformation transformation spectrum of the currently detected malicious code and analyze its homology. 此外，本发明实施例中还可以直接通过已训练的恶意代码分类器对恶意代码进行检测，输出对其的同源性分析结果，具体地：In addition, in the embodiment of the present invention, the malicious code can also be detected directly through the trained malicious code classifier, and the homology analysis result of it can be output, specifically: 步骤S30，将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息，其中，所述预设恶意代码分类器是基于恶意代码样本的奇异变换谱训练获得。Step S30, input the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtain family information to which the malicious code belongs, wherein the preset malicious code classifier is based on malicious code samples The singular transformation spectrum of is obtained by training. 恶意代码可视化及变种检测设备中预设恶意代码分类器，预设恶意代码分类器是预先根据恶意代码样本的奇异谱变换变换谱训练所得，具体的训练方式既可为直接使用恶意代码样本的奇异谱变换变换谱进行机器学习训练，也可为先提取恶意代码样本的奇异谱变换变换谱的时间序列信号特征后，再使用时间序列信号特征进行机器学习训练。训练过程中具体采用的分类算法可为贝叶斯分类器，K最近邻(kNN，k-NearestNeighbor)，支持向量机（SVM，Support Vector Machine），决策树等，可根据实际情况灵活选择，本实施例对此不作具体限定。Malicious code visualization and variant detection equipment preset malicious code classifiers. The preset malicious code classifiers are pre-trained according to the singular spectrum transformation transformation spectrum of malicious code samples. The specific training method can be directly using the singularity spectrum of malicious code samples The spectral transformation transforms the spectrum for machine learning training, and can also be used to extract the time series signal features of the malicious code sample after the singular spectral transform transformation spectrum, and then use the time series signal features for machine learning training. The specific classification algorithm used in the training process can be Bayesian classifier, K nearest neighbor (kNN, k-NearestNeighbor), support vector machine (SVM, Support Vector Machine), decision tree, etc., which can be flexibly selected according to the actual situation. The embodiment does not specifically limit this. 恶意代码可视化及变种检测设备将当前需要检测的恶意代码所对应的奇异谱变换变换谱作为恶意代码分类器的输入，或提取出奇异谱变换变换谱的时间序列特征，将其时间序列特征作为恶意代码分类器的输入，分类器即可依据奇异谱变换变换谱或是时间序列特征对恶意代码进行同源性分析，最终输出当前待检测恶意代码的所述家族信息。另外，在当前所要检测的恶意代码在经过恶意代码分类器的同源性分析后，也可作为新的恶意代码样本对分类器进行训练，以进一步优化分类器的判别性能。Malicious code visualization and variant detection equipment uses the singular spectral transformation spectrum corresponding to the malicious code currently to be detected as the input of the malicious code classifier, or extracts the time series features of the singular spectral transformation spectrum, and uses its time series features as malicious As the input of the code classifier, the classifier can perform homology analysis on the malicious code according to the singular spectral transformation transform spectrum or time series features, and finally output the family information of the currently to-be-detected malicious code. In addition, after the malicious code to be detected is analyzed by the homology of the malicious code classifier, it can also be used as a new malicious code sample to train the classifier, so as to further optimize the discriminant performance of the classifier. 本发明实施例中通过将恶意代码转化为一维时间序列信号，以便获取恶意代码的时间序列信号特征，相比提取静态语义特征以及二维图像纹理特征，大大减小了时间开销；通过输出恶意代码所对应的奇异变换谱，便于从视觉上直观感知各个变种的共同之处和细微差异，为理解和掌握该家族变种演化提供了依据；通过基于恶意代码样本对应的奇异变换谱进行分类模型训练，使得恶意代码家族分类更加快速准确。本发明实施例中的可视化分析能够采用程序化的方式执行，相比恶意代码静态语义特征的分析，降低了恶意代码分析人员的专业技术要求，从而解决了现有的恶意代码可视化及变种检测方法的效率低下的技术问题。In the embodiment of the present invention, the malicious code is converted into a one-dimensional time series signal in order to obtain the time series signal features of the malicious code, which greatly reduces the time overhead compared with extracting static semantic features and two-dimensional image texture features; by outputting malicious code The singular transformation spectrum corresponding to the code is convenient for visually perceiving the commonalities and subtle differences of each variant, which provides a basis for understanding and mastering the evolution of the family variants; the classification model training is carried out based on the singular transformation spectrum corresponding to the malicious code samples , making the classification of malicious code families faster and more accurate. The visual analysis in the embodiment of the present invention can be performed in a procedural manner. Compared with the analysis of static semantic features of malicious code, the professional technical requirements of malicious code analysts are reduced, thereby solving the existing malicious code visualization and variant detection methods. technical inefficiencies. 进一步地，基于本发明恶意代码可视化及变种检测方法的第一实施例，提出本发明恶意代码可视化及变种检测方法的第二实施例。Further, based on the first embodiment of the malicious code visualization and variant detection method of the present invention, a second embodiment of the malicious code visualization and variant detection method of the present invention is proposed. 在本实施例是第一实施例中步骤S10的细化，本实施例与上述实施例的区别在于：This embodiment is the refinement of step S10 in the first embodiment, and the difference between this embodiment and the above-mentioned embodiment is: 获取待检测的恶意代码，及所述恶意代码的二进制可执行文件，将所述二进制可执行文件转换为一维整数数组；Obtain the malicious code to be detected, and the binary executable file of the malicious code, and convert the binary executable file into a one-dimensional integer array; 将所述一维整数数组按照预设采样规则进行下采样，获得一维时间序列信号。The one-dimensional integer array is down-sampled according to a preset sampling rule to obtain a one-dimensional time series signal. 恶意代码可视化及变种检测设备确定当前需要检测的恶意代码的二进制可执行文件，恶意代码可视化及变种检测设备在获取到当前需要检测的恶意代码文件时，从中读取恶意代码数据，并按照每预设二进制位数对应一无符号整数的转换规则，将二进制的恶意代码数据转换成一维无符号整数数组。优选地，预设二进制位数为八位，取值范围为0至255，待文件全部读取完毕时，即可将需要检测的恶意代码全部转换为一维整数数组。恶意代码可视化及变种检测设备将二进制恶意代码数据转换得到的一维整数数组视为一维样值时间序列信号，并按照固定长度或是一定比例进行下采样，即可在一维样值时间序列信号的基础上得到一维时间序列信号。其中，对于一个样值序列间隔几个样值取样一次，这样得到新序列就是原序列的下采样。其中，固定长度与一定比例可根据实际情况灵活调节，本实施例不做具体限定。The malicious code visualization and variant detection device determines the binary executable file of the malicious code that needs to be detected currently. When the malicious code visualization and variant detection device obtains the malicious code file that needs to be detected currently, it reads the malicious code data from Assuming that the number of binary digits corresponds to a conversion rule of an unsigned integer, the binary malicious code data is converted into a one-dimensional array of unsigned integers. Preferably, the preset binary number is eight, and the value ranges from 0 to 255. When all the files are read, all the malicious codes to be detected can be converted into a one-dimensional integer array. Malicious code visualization and variant detection equipment treats the one-dimensional integer array converted from binary malicious code data as a one-dimensional sample time series signal, and performs downsampling according to a fixed length or a certain ratio, so that the one-dimensional sample time series The basis of the signal is to obtain a one-dimensional time series signal. Among them, a sample value sequence is sampled at intervals of several samples, so that the new sequence obtained in this way is the downsampling of the original sequence. Wherein, the fixed length and the certain ratio can be flexibly adjusted according to the actual situation, and are not specifically limited in this embodiment. 本实施例中恶意代码可视化及变种检测设备将恶意代码转化为一维时间序列信号，以方便进行准确分析。In this embodiment, the malicious code visualization and variant detection device converts the malicious code into a one-dimensional time series signal to facilitate accurate analysis. 进一步地，基于本发明恶意代码可视化及变种检测方法的上述实施例，提出本发明恶意代码可视化及变种检测方法的第三实施例Further, based on the above-mentioned embodiments of the malicious code visualization and variant detection method of the present invention, the third embodiment of the malicious code visualization and variant detection method of the present invention is proposed 在本实施例是第一实施例中步骤S20的细化，本实施例与上述实施例的区别在于：This embodiment is the refinement of step S20 in the first embodiment, and the difference between this embodiment and the above-mentioned embodiment is: 将所述一维时间序列信号组合形成时间集合，将所述时间集合转化为预设长度的时间子序列；combining the one-dimensional time series signals to form a time set, and converting the time set into a time subsequence of a preset length; 根据所述时间子序列构造轨迹矩阵，根据所述时间子序列构造测试矩阵，根据所述轨迹矩阵和所述测试矩阵确定变化点分数；Constructing a trajectory matrix according to the time subsequence, constructing a test matrix according to the time subsequence, determining a change point score according to the trajectory matrix and the test matrix; 以所述一维时间序列信号中的时刻为横坐标，以所述变化点分数为纵坐标，获得所述恶意代码对应的奇异变换谱并输出显示。Taking the time in the one-dimensional time series signal as the abscissa and the change point score as the ordinate, obtain the singular transformation spectrum corresponding to the malicious code and output it for display. 在本实施例中恶意代码可视化及变种检测设备将一维时间序列信号组合形成时间集合，将时间集合转化为预设长度的时间子序列；根据时间子序列构造轨迹矩阵，根据时间子序列构造测试矩阵，根据轨迹矩阵和测试矩阵确定变化点分数；以一维时间序列信号中的时刻为横坐标，以变化点分数为纵坐标，获得恶意代码对应的奇异变换谱，方便用户比对奇异变换谱中各个时刻对应的差异。In this embodiment, the malicious code visualization and variant detection equipment combines one-dimensional time series signals to form a time set, and converts the time set into a time subsequence of a preset length; constructs a trajectory matrix according to the time subsequence, and constructs a test according to the time subsequence Matrix, determine the change point score according to the trajectory matrix and test matrix; take the time in the one-dimensional time series signal as the abscissa, and take the change point score as the ordinate to obtain the singular transformation spectrum corresponding to the malicious code, which is convenient for users to compare the singular transformation spectrum The difference corresponding to each moment in . 具体地，恶意代码可视化及变种检测设备将这个一维时间序列信号，记为集合/>，第t个信号定义为第t个时刻，则长度为W的/>的子序列为/>，其中，上标T表示转置；Specifically, the malicious code visualization and variant detection equipment takes this one-dimensional time series signal , denoted as a collection /> , the tth signal is defined as the tth moment, then the length is W's /> The subsequence of /> , where the superscript T means transpose; 定义t时刻，由子序列构造的轨迹矩阵/>为:Define time t by subsequence Constructed trajectory matrix /> for: 其中，表示该子序列设定的窗口长度，/>表示该子序列设定的延迟长度，/>表示该子序列设定的阶数，/>是Hankel矩阵, 沿次对角线元素相同。in, Indicates the window length set by the subsequence, /> Indicates the delay length set by the subsequence, /> Indicates the order of the subsequence setting, /> is a Hankel matrix with the same elements along the secondary diagonal. 定义t时刻，由子序列构造的测试矩阵/>为:Define time t by subsequence Constructed test matrix /> for: 其中，表示该子序列设定的窗口长度，/>表示该子序列设定的阶数，/>是Hankel矩阵, 沿次对角线元素相同。in, Indicates the window length set by the subsequence, /> Indicates the order of the subsequence setting, /> is a Hankel matrix with the same elements along the secondary diagonal. 定义t时刻，变化点分数为为：Define time t, the change point score is for: 其中，是t时刻的测试矩阵经过奇异值分解后的左奇异向量，r为所取主成分的个数，/>是t时刻的测试矩阵经过奇异值分解后的最大左奇异向量，/>表示向量内积，。in, is the left singular vector of the test matrix at time t after singular value decomposition, r is the number of principal components taken, /> is the largest left singular vector after singular value decomposition of the test matrix at time t, /> Indicates the vector inner product, . 将恶意代码转化为的一维时间序列信号所有时刻对应的变化点分数/>，作为该恶意代码的SST谱。One-dimensional time series signal that transforms malicious code into Change point scores corresponding to all moments /> , as the SST spectrum of the malicious code. 本实施例中将恶意代码转化为奇异变换谱可以实现恶意代码直观查询，以方便分析人员快速地定位恶意代码。In this embodiment, transforming the malicious code into a singular transformation spectrum can realize an intuitive query of the malicious code, so that analysts can quickly locate the malicious code. 进一步地，基于本发明恶意代码可视化及变种检测方法第一实施例，提出了本发明的第四实施例。Further, based on the first embodiment of the malicious code visualization and variant detection method of the present invention, a fourth embodiment of the present invention is proposed. 在本实施例中是第一实施例中步骤S30之前的步骤，本实施例给出了一种恶意代码分类器具体训练方式，包括：In this embodiment, it is the step before step S30 in the first embodiment. This embodiment provides a specific training method for a malicious code classifier, including: 从预设恶意代码文件数据库中抽取恶意代码样本，将各所述恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；extracting malicious code samples from the preset malicious code file database, performing singular spectrum transformation on each of the malicious code samples, and obtaining a singular transformation spectrum corresponding to each of the malicious code samples; 将各所述奇异变换谱划分形成第一训练集与第一测试集；dividing each singular transformation spectrum to form a first training set and a first test set; 通过所述第一训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；Iteratively training the initial classification algorithm through the singular transformation spectrum in the first training set to obtain a malicious code classifier; 通过所述第一测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code classifier is verified through the first test set to obtain a preset malicious code classifier. 在本实施例中，提供了两种分类器训练方式，第一种是直接使用恶意代码的奇异谱变换变换谱进行机器学习训练。第一训练集为采用预设恶意代码分类器训练方式时的训练集数据，第一测试集为采用预设恶意代码分类器训练方式时的测试集数据。第一预设分类算法为采用第一种训练方式进行分类器训练时所使用的分类算法，具体可为随机森林算法、极端随机数算法等。In this embodiment, two classifier training methods are provided. The first one is to directly use the singular spectrum transform transform spectrum of the malicious code for machine learning training. The first training set is the training set data when the preset malicious code classifier training method is adopted, and the first test set is the test set data when the preset malicious code classifier training method is adopted. The first preset classification algorithm is the classification algorithm used when the classifier is trained using the first training method, which may specifically be a random forest algorithm, an extreme random number algorithm, or the like. 恶意代码可视化及变种检测设备从预设恶意代码文件数据库中抽取恶意代码样本，将各所述恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；将各所述奇异变换谱划分形成第一训练集与第一测试集；通过所述第一训练集中的奇异变换谱对初始分类算法（初始分类算法是指预先设置的分析算法）进行迭代训练，获得恶意代码分类器；通过所述第一测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code visualization and variant detection equipment extracts malicious code samples from the preset malicious code file database, performs singular spectrum transformation on each of the malicious code samples, and obtains the corresponding singular transformation spectrum of each of the malicious code samples; The transformation spectrum is divided to form the first training set and the first test set; the initial classification algorithm (the initial classification algorithm refers to the preset analysis algorithm) is iteratively trained through the singular transformation spectrum in the first training set to obtain a malicious code classifier ; Verifying the malicious code classifier through the first test set to obtain a preset malicious code classifier. 具体地，如图4所示，图4为第一种预设恶意代码分类器的训练方式示意图。本实施例中选择malimg恶意代码文件数据库，该数据库包含了25个恶意代码家族，共有9327个恶意代码文件，将该数据库中的每一个恶意代码文件，按每8位二进制作为一个无符号整数，转换为一个时间序列信号，再按n=4096进行下采样，再将下采样后的时间序列信号进行奇异谱变换，按恶意代码二进制执行文件名生成对应恶意代码SST谱数据。循环执行，最终生成malimg恶意代码SST谱数据库。其中，对于奇异谱变换的参数选择：子序列窗口长度W=5，子序列设定的延迟长度L=10，子序列设定的阶数K=60,主成分r=10。采用机器学习方法，训练恶意代码SST谱数据库，将80%的数据作为训练集，20%的数据作为测试集，重复10次交叉验证，对恶意代码家族进行分类。采用随机森林，分类准确率为98.24%；采用极端随机树，分类准确率为98.35%。其中，采用极端随机树训练的恶意代码分类混淆矩阵如图5所示，如图5所示，图5为Malimg恶意代码分类混淆矩阵示意图，左边的纵列标明了恶意代码的真实类别名称索引（Index of 1 Classes），下方的纵列均标明了恶意代码的预测类别名称索引（Index of Predict Classes），如位列第一位的Adialer.C（一种病毒种类名称），位列末位的Yuner.A（一种病毒种类名称）等。矩阵中的数字代表真实类别与预测类别之间的相似度。Specifically, as shown in FIG. 4 , FIG. 4 is a schematic diagram of a training method of the first preset malicious code classifier. Select malimg malicious code file database among the present embodiment, this database has included 25 malicious code families, has 9327 malicious code files altogether, each malicious code file in this database, by every 8-bit binary as an unsigned integer, Convert it into a time series signal, then down-sample according to n=4096, and then perform singular spectrum transformation on the down-sampled time series signal, and generate corresponding malicious code SST spectrum data according to the malicious code binary execution file name. Execute in a loop to finally generate the malimg malicious code SST spectrum database. Among them, for the parameter selection of the singular spectrum transformation: the subsequence window length W=5, the delay length L=10 set by the subsequence, the order K=60 set by the subsequence, and the principal component r=10. Using machine learning method to train the malicious code SST spectrum database, 80% of the data is used as the training set, 20% of the data is used as the test set, and the cross-validation is repeated 10 times to classify the malicious code family. Using random forest, the classification accuracy rate is 98.24%; using extreme random tree, the classification accuracy rate is 98.35%. Among them, the malicious code classification confusion matrix trained by the extreme random tree is shown in Figure 5, as shown in Figure 5, and Figure 5 is a schematic diagram of the Malimg malicious code classification confusion matrix, and the column on the left indicates the real category name index of the malicious code ( Index of 1 Classes), the columns below indicate the Index of Predict Classes of malicious codes, such as Adialer. Yuner.A (a virus species name), etc. The numbers in the matrix represent the similarity between the true and predicted classes. 进一步地，基于本发明恶意代码可视化及变种检测方法第一实施例，提出了本发明的第五实施例。Further, based on the first embodiment of the malicious code visualization and variant detection method of the present invention, a fifth embodiment of the present invention is proposed. 在本实施例中是第一实施例中步骤S30之前的步骤，本实施例给出了另一种恶意代码分类器具体训练方式，包括：In this embodiment, it is the step before step S30 in the first embodiment. This embodiment provides another specific training method for malicious code classifiers, including: 将预设恶意代码文件数据库中的恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；performing singular spectrum transformation on the malicious code samples in the preset malicious code file database to obtain a singular transformation spectrum corresponding to each of the malicious code samples; 从各所述奇异变换谱中提取样本时间序列特征，将各所述样本时间序列特征划分形成第二训练集与第二测试集；extracting sample time series features from each of the singular transformation spectra, and dividing each of the sample time series features to form a second training set and a second test set; 通过所述第二训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；Iteratively training the initial classification algorithm through the singular transformation spectrum in the second training set to obtain a malicious code classifier; 通过所述第二测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code classifier is verified through the second test set to obtain a preset malicious code classifier. 即，恶意代码可视化及变种检测设备将预设恶意代码文件数据库中的恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；从各所述奇异变换谱中提取样本时间序列特征，将各所述样本时间序列特征划分形成第二训练集与第二测试集；通过所述第二训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；通过所述第二测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。That is, the malicious code visualization and variant detection device performs singular spectrum transformation on the malicious code samples in the preset malicious code file database to obtain the corresponding singular transformation spectrum of each of the malicious code samples; extract the sample time from each of the singular transformation spectra Sequence features, dividing the time series features of each sample to form a second training set and a second test set; performing iterative training on the initial classification algorithm through the singular transformation spectrum in the second training set to obtain a malicious code classifier; The second test set verifies the malicious code classifier to obtain a preset malicious code classifier. 如图6所示，图6为另一种恶意代码分类器的训练方式示意图。恶意代码可视化及变种检测设备选择malheur恶意代码文件数据库，该数据库包含了24个恶意代码家族，共有3131个恶意代码文件；将该数据库中的每一个恶意代码文件，按每8位二进制作为一个无符号整数，转换为一个时间序列信号，再按n=4096进行下采样，再将下采样后的时间序列信号进行奇异谱变换，按恶意代码二进制执行文件名生成对应恶意代码SST谱数据。再对恶意代码SST谱，提取对数梅尔滤波器组能量（log Mel-filterbank energy）时间序列特征。循环执行，最终生成malheur恶意代码SST谱数据库。其中，对于奇异谱变换的参数选择：子序列窗口长度W=5，子序列设定的延迟长度L=10，子序列设定的阶数K=60,主成分r=10。装置采用机器学习方法，训练恶意代码奇异谱变换变换谱及特征数据库，将80%的数据作为第二训练集，20%的数据作为第二测试集，重复10次交叉验证，对恶意代码家族进行分类。经实验后表明，采用随机森林算法得到的分类准确率为98.58%；采用极端随机树得到的分类准确率为98.77%。需要说明的是，若装置是通过预设恶意代码分类器训练方式得到恶意代码分类器，则在对当前需要检测的恶意代码进行变种检测时，需要获取到其对应的奇异谱变换变换谱，并从奇异谱变换变换谱中提取出时间序列特征，才可通过该恶意代码分类器对恶意代码进行变种检测。如图7所示，图7为Malheur恶意代码分类混淆矩阵示意图。左边的纵列标明了恶意代码的真实类别名称索引（Index of 1 Classes），下采用机器学习方法，训练恶意代码SST谱及特征数据库，将80%的数据作为训练集，20%的数据作为测试集，重复10次交叉验证，对恶意代码家族进行分类。采用随机森林，分类准确率为98.56%；采用极端随机树，分类准确率为98.72%。其中，采用极端随机树训练的恶意代码分类混淆矩阵如图7所示。As shown in FIG. 6 , FIG. 6 is a schematic diagram of another training method of a malicious code classifier. The malicious code visualization and variant detection equipment selects the malheur malicious code file database, which contains 24 malicious code families and a total of 3131 malicious code files; each malicious code file in the database is regarded as an 8-bit binary The symbolic integer is converted into a time series signal, and then down-sampled according to n=4096, and then the down-sampled time series signal is subjected to singular spectrum transformation, and the corresponding malicious code SST spectrum data is generated according to the malicious code binary execution file name. Then, extract the log Mel-filterbank energy time series features of the malicious code SST spectrum. Loop execution, and finally generate malheur malicious code SST spectrum database. Among them, for the parameter selection of the singular spectrum transformation: the subsequence window length W=5, the delay length L=10 set by the subsequence, the order K=60 set by the subsequence, and the principal component r=10. The device adopts machine learning methods to train the singular spectrum transformation spectrum and feature database of malicious codes. 80% of the data is used as the second training set, and 20% of the data is used as the second test set. The cross-validation is repeated 10 times, and the malicious code family is tested. Classification. The experiment shows that the classification accuracy rate obtained by using the random forest algorithm is 98.58%; the classification accuracy rate obtained by using the extreme random tree is 98.77%. It should be noted that if the device obtains the malicious code classifier through the preset malicious code classifier training method, then when performing variant detection on the malicious code currently to be detected, it is necessary to obtain its corresponding singular spectrum transformation spectrum, and Only when the time series features are extracted from the singular spectrum transform transform spectrum can the malicious code classifier be used to detect the variants of the malicious code. As shown in Figure 7, Figure 7 is a schematic diagram of the confusion matrix of Malheur malicious code classification. The column on the left indicates the real category name index (Index of 1 Classes) of the malicious code. Next, the machine learning method is used to train the SST spectrum and feature database of the malicious code. 80% of the data is used as the training set and 20% of the data is used as the test Set, repeated 10 times cross-validation, to classify malicious code families. Using random forest, the classification accuracy rate is 98.56%; using extreme random tree, the classification accuracy rate is 98.72%. Among them, the malicious code classification confusion matrix trained by extreme random tree is shown in Figure 7. 在本实施例中，第二种是先提取恶意代码的奇异谱变换变换谱的时间序列信号特征，再使用时间序列信号特征来进行机器学习训练。样本时间序列特征为在模型训练阶段中，从恶意代码样本所对应的奇异谱变换变换谱中提取出的时间序列特征。第二训练集为采用预设恶意代码分类器训练方式时的训练集数据，第二测试集为采用预设恶意代码分类器训练方式时的测试集数据。第二预设分类算法为采用第二种训练方式进行分类器训练时所使用的分类算法，具体可为随机森林算法、极端随机数算法等，第二预设分类算法可与第一预设分类算法相同，也可不同。其中，时间序列信号特征优选为对数梅尔滤波器组能量。In this embodiment, the second method is to first extract the time series signal features of the singular spectrum transformation spectrum of the malicious code, and then use the time series signal features for machine learning training. The sample time series feature is the time series feature extracted from the singular spectrum transform spectrum corresponding to the malicious code sample in the model training stage. The second training set is the training set data when the preset malicious code classifier training method is adopted, and the second test set is the test set data when the preset malicious code classifier training method is adopted. The second preset classification algorithm is the classification algorithm used when the classifier is trained in the second training method, specifically, it can be a random forest algorithm, an extreme random number algorithm, etc. The second preset classification algorithm can be compared with the first preset classification algorithm. Algorithms are the same or different. Wherein, the time series signal feature is preferably logarithmic mel filter bank energy. 进一步地，基于本发明恶意代码可视化及变种检测方法的上述实施例，提出本发明恶意代码可视化及变种检测方法的第六实施例。Further, based on the above-mentioned embodiments of the malicious code visualization and variant detection method of the present invention, a sixth embodiment of the malicious code visualization and variant detection method of the present invention is proposed. 本实施例是第一实施例中步骤S30的细化，本实施中给出了两种通过预设恶意代码分类器进行恶意代码可视化及变种检测的具体实现方式，This embodiment is a refinement of step S30 in the first embodiment. In this embodiment, two specific implementations of malicious code visualization and variant detection through a preset malicious code classifier are given. 实现方式一为：Implementation method one is: 将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码的分类结果；Inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the classification result of the malicious code; 在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；When the classification result is the first category, then output the family information of the malicious code; 在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。When the classification result is the second type, it is determined that the malicious code is listed as a new type of malicious code family and output prompt information. 实现方式二为：The second implementation method is: 从所述恶意代码对应的奇异变换谱中提取的待测时间序列特征，将所述待测时间序列特征输入预设恶意代码分类器，获取分类结果；From the time series features to be tested extracted from the singular transformation spectrum corresponding to the malicious code, inputting the time series features to be tested into a preset malicious code classifier to obtain classification results; 在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；When the classification result is the first category, then output the family information of the malicious code; 在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。When the classification result is the second type, it is determined that the malicious code is listed as a new type of malicious code family and output prompt information. 在本实施例中待测时间序列特征为利用已训练的分类器对待测恶意代码进行变种检测时，从待检测的恶意代码所对应的奇异谱变换变换谱中提取出的时间序列特征。若当前所使用的分类器是采用第一种训练方式训练所得，则将当前所要检测的恶意代码所对应的奇异谱变换变换谱作为预先已训练好的用于恶意代码同源性分析的恶意代码分类器的输入；若当前所使用的分类器是采用第二种训练方式训练所得，则先对当前所要检测的恶意代码所对应的奇异谱变换变换谱进行时间序列特征提取，再将提取出的待测时间序列特征作为预先已训练好的用于恶意代码同源性分析的恶意代码分类器的输入。分类器即可对其进行变种检测，判断当前所要检测的恶意代码是否为已有恶意代码的变种。若装置判定当前所要检测的恶意代码为已有恶意代码的变种，则获取与当前恶意代码同源的已有恶意代码的所属家族信息，以便用户获知当前所检测的恶意代码为已有恶意代码的变种；若装置判定当前所要检测的恶意代码并非已有恶意代码的变种，也即是当前的恶意代码不与任何一种已知的恶意代码同源，则将该恶意代码列为新的一种恶意代码家族，同时可输出为查询到同源信息的相关提示信息，以便用户获知该恶意代码不与已有恶意代码同源，是一种新型恶意代码。In this embodiment, the time series feature to be tested is the time series feature extracted from the singular spectrum transformation spectrum corresponding to the malicious code to be detected when the trained classifier is used to detect the variant of the malicious code to be tested. If the currently used classifier is trained by the first training method, the singular spectrum transformation spectrum corresponding to the malicious code to be detected is used as the pre-trained malicious code for homology analysis of malicious code The input of the classifier; if the currently used classifier is trained by the second training method, first perform time series feature extraction on the singular spectrum transform spectrum corresponding to the malicious code to be detected, and then extract the extracted The time series features to be tested are used as the input of a pre-trained malicious code classifier for homology analysis of malicious codes. The classifier can perform variant detection on it, and judge whether the currently malicious code to be detected is a variant of the existing malicious code. If the device determines that the currently detected malicious code is a variant of the existing malicious code, then obtain the family information of the existing malicious code with the same source as the current malicious code, so that the user knows that the currently detected malicious code is a variant of the existing malicious code. variant; if the device determines that the malicious code to be detected is not a variant of the existing malicious code, that is, the current malicious code does not have the same source as any known malicious code, it will list the malicious code as a new type Malicious code family, at the same time, it can be output as relevant prompt information for querying the same source information, so that users can know that the malicious code is not the same source as the existing malicious code, and it is a new type of malicious code. 在本实施例中通过将恶意代码转换为一维整数数组，并对其进行下采样得到一维时间序列信号并输出，可以有效的将恶意代码可视为一维的时间序列信号，对恶意代码的变种能够产生更抗混淆性和抗干扰性的谱特征，能够按照恶意代码家族进行划分，并发现新的家族，对数据集具有更好的适应性和健壮性，从而有效提高恶意代码可视化及变种检测效率，也可以通过家族划分来追溯恶意代码来源，达到恶意代码同源性判定的作用。In this embodiment, by converting the malicious code into a one-dimensional integer array, and downsampling it to obtain a one-dimensional time series signal and outputting it, the malicious code can be effectively regarded as a one-dimensional time series signal, and the malicious code The variants can produce more anti-obfuscation and anti-jamming spectral features, can be divided according to malicious code families, and discover new families, and have better adaptability and robustness to the data set, thus effectively improving the visibility of malicious code and The efficiency of variant detection can also be traced back to the source of malicious code through family division, so as to achieve the function of judging the homology of malicious code. 在本实施例中，进一步通过设置两种分类器的训练方式，预先对一定数量的训练数据集与测试数据集进行机器学习训练，使得能够采用已训练的分类器对待检测的恶意代码进行快速准确的变种检测，提升了变种检测的效率。In this embodiment, by setting two kinds of classifier training methods, machine learning training is performed on a certain number of training data sets and test data sets in advance, so that the trained classifier can be used to quickly and accurately detect malicious codes. The variant detection improves the efficiency of variant detection. 本发明还提供一种恶意代码可视化及变种检测装置。The invention also provides a malicious code visualization and variation detection device. 获取转化模块，用于获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号；Obtaining a transformation module, configured to obtain malicious codes to be detected, and convert the malicious codes into one-dimensional time series signals; 变化谱生成模块，用于将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；A variation spectrum generating module, configured to perform singular spectrum transformation on the one-dimensional time series signal, obtain the singular transformation spectrum corresponding to the malicious code and output and display it; 检测确定模块，用于将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息，其中，所述预设恶意代码分类器是基于恶意代码样本的奇异变换谱训练获得。A detection determination module, configured to input the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtain family information to which the malicious code belongs, wherein the preset malicious code classifier is based on Singular transformation spectrum training of malicious code samples is obtained. 在一实施例中，所述获取转化模块，包括：In one embodiment, the acquisition conversion module includes: 获取转换单元，用于获取待检测的恶意代码，及所述恶意代码的二进制可执行文件，将所述二进制可执行文件转换为一维整数数组；Obtaining a conversion unit for obtaining the malicious code to be detected and the binary executable file of the malicious code, and converting the binary executable file into a one-dimensional integer array; 采用获取单元，用于将所述一维整数数组按照预设采样规则进行下采样，获得一维时间序列信号。An acquisition unit is used for down-sampling the one-dimensional integer array according to a preset sampling rule to obtain a one-dimensional time series signal. 在一实施例中，所述变化谱生成模块，包括：In one embodiment, the variation spectrum generation module includes: 第一转化单元，用于将所述一维时间序列信号组合形成时间集合，将所述时间集合转化为预设长度的时间子序列；A first conversion unit, configured to combine the one-dimensional time series signals to form a time set, and convert the time set into a time subsequence of a preset length; 分数确定单元，用于根据所述时间子序列构造轨迹矩阵，根据所述时间子序列构造测试矩阵，根据所述轨迹矩阵和所述测试矩阵确定变化点分数；A score determination unit, configured to construct a trajectory matrix according to the time subsequence, construct a test matrix according to the time subsequence, and determine a change point score according to the trajectory matrix and the test matrix; 奇异变换谱生成单元，用于以所述一维时间序列信号中的时刻为横坐标，以所述变化点分数为纵坐标，获得所述恶意代码对应的奇异变换谱并输出显示。The singular transformation spectrum generation unit is configured to use the time in the one-dimensional time series signal as the abscissa and the change point score as the ordinate to obtain the singular transformation spectrum corresponding to the malicious code and output it for display. 在一实施例中，所述的恶意代码可视化及变种检测装置，包括：In one embodiment, the malicious code visualization and variant detection device includes: 样本处理模块，用于从预设恶意代码文件数据库中抽取恶意代码样本，将各所述恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；The sample processing module is used to extract malicious code samples from the preset malicious code file database, perform singular spectrum transformation on each of the malicious code samples, and obtain a singular transformation spectrum corresponding to each of the malicious code samples; 图谱处理模块，用于将各所述奇异变换谱划分形成第一训练集与第一测试集；A spectrum processing module, configured to divide each singular transformation spectrum to form a first training set and a first test set; 迭代训练模块，用于通过所述第一训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；An iterative training module, configured to iteratively train the initial classification algorithm through the singular transformation spectrum in the first training set to obtain a malicious code classifier; 分离器验证模块，用于通过所述第一测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。A separator verification module, configured to verify the malicious code classifier through the first test set to obtain a preset malicious code classifier. 在一实施例中，所述检测确定模块，包括：In one embodiment, the detection determination module includes: 输入检测单元，用于将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码的分类结果；The input detection unit is used to input the singular transformation spectrum corresponding to the malicious code to the preset malicious code classifier for variant detection, and obtain the classification result of the malicious code; 第一输出单元，用于在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；A first output unit, configured to output family information of the malicious code when the classification result is the first type; 第二检测单元，用于在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。The second detection unit is configured to determine that the malicious code is listed as a new type of malicious code family and output prompt information when the classification result is the second type. 在一实施例中，所述的恶意代码可视化及变种检测装置，包括：In one embodiment, the malicious code visualization and variant detection device includes: 奇异谱变换模块，用于将预设恶意代码文件数据库中的恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；The singular spectrum transformation module is used to perform singular spectrum transformation on the malicious code samples in the preset malicious code file database to obtain the singular transformation spectrum corresponding to each of the malicious code samples; 特征提取模块，用于从各所述奇异变换谱中提取样本时间序列特征，将各所述样本时间序列特征划分形成第二训练集与第二测试集；A feature extraction module, configured to extract sample time series features from each of the singular transformation spectra, and divide each of the sample time series features to form a second training set and a second test set; 迭代训练模块，用于通过所述第二训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；An iterative training module, configured to iteratively train the initial classification algorithm through the singular transformation spectrum in the second training set to obtain a malicious code classifier; 分类器生成模块，用于通过所述第二测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。A classifier generating module, configured to verify the malicious code classifier through the second test set to obtain a preset malicious code classifier. 在一实施例中，所述检测确定模块30，包括：In one embodiment, the detection determination module 30 includes: 提取输入单元，用于从所述恶意代码对应的奇异变换谱中提取的待测时间序列特征，将所述待测时间序列特征输入预设恶意代码分类器，获取分类结果；The extraction input unit is used to extract the time series features to be tested from the singular transformation spectrum corresponding to the malicious code, and input the time series features to be tested into a preset malicious code classifier to obtain classification results; 第一输出单元，用于在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；A first output unit, configured to output family information of the malicious code when the classification result is the first type; 第二输出单元，用于在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。The second output unit is configured to determine that the malicious code is listed as a new type of malicious code family and output prompt information when the classification result is the second type. 本发明实施例中通过将恶意代码转化为一维时间序列信号，以便获取恶意代码的时间序列信号特征，将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；通过输出恶意代码所对应的奇异变换谱，便于直观感知各个变种的共同之处和细微差异，将恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得恶意代码所属的家族信息，使得恶意代码家族分类更加快速准确；与此同时，本发明实施例中的技术方法降低了恶意代码分析人员的专业技术要求，减少了人力资源浪费。In the embodiment of the present invention, the malicious code is converted into a one-dimensional time series signal in order to obtain the characteristics of the time series signal of the malicious code, and the singular spectrum transformation is performed on the one-dimensional time series signal to obtain the singular transformation spectrum corresponding to the malicious code And output the display; by outputting the singular transformation spectrum corresponding to the malicious code, it is convenient to intuitively perceive the commonality and subtle differences of each variant, input the singular transformation spectrum corresponding to the malicious code to the preset malicious code classifier for variant detection, and obtain malicious The family information to which the code belongs makes the classification of malicious code families more rapid and accurate; at the same time, the technical method in the embodiment of the present invention reduces the professional technical requirements of malicious code analysts and reduces the waste of human resources. 其中，所述恶意代码可视化及变种检测装置被执行时所实现的方法可参照本发明恶意代码可视化及变种检测方法的各个实施例，此处不再赘述。Wherein, the method implemented when the malicious code visualization and variant detection device is executed can refer to the various embodiments of the malicious code visualization and variant detection method of the present invention, which will not be repeated here. 本发明还提供一种存储介质。The invention also provides a storage medium. 本发明存储介质上存储有恶意代码可视化及变种检测程序，所述恶意代码可视化及变种检测程序被处理器执行时实现如上所述的恶意代码可视化及变种检测方法的步骤。A malicious code visualization and variant detection program is stored on the storage medium of the present invention, and when the malicious code visualization and variant detection program is executed by a processor, the steps of the above-mentioned malicious code visualization and variant detection method are realized. 其中，所述恶意代码可视化及变种检测程序被执行时所实现的方法可参照本发明恶意代码可视化及变种检测方法各个实施例，此处不再赘述。For the methods implemented when the malicious code visualization and variant detection program is executed, reference may be made to various embodiments of the malicious code visualization and variant detection method of the present invention, which will not be repeated here. 需要说明的是，在本文中，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者装置不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者装置所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括该要素的过程、方法、物品或者装置中还存在另外的相同要素。It should be noted that, in this document, the term 'comprising', 'comprising' or any other variation thereof is intended to cover a non-exclusive inclusion such that a process, method, article or apparatus comprising a set of elements includes not only those elements, It also includes other elements not expressly listed, or elements inherent in the process, method, article, or device. Without further limitations, an element defined by the phrase 'comprising a ...' does not preclude the presence of additional identical elements in the process, method, article, or apparatus comprising that element. 上述本发明实施例序号仅仅为了描述，不代表实施例的优劣。The serial numbers of the above embodiments of the present invention are for description only, and do not represent the advantages and disadvantages of the embodiments. 通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到上述实施例方法可借助软件加必需的通用硬件平台的方式来实现，当然也可以通过硬件，但很多情况下前者是更佳的实施方式。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品存储在如上所述的一个存储介质(如ROM/RAM、磁碟、光盘)中，包括若干指令用以使得一台恶意代码可视化及变种检测设备(可以是手机，计算机，服务器，或者网络设备等)执行本发明各个实施例所述的方法。Through the description of the above embodiments, those skilled in the art can clearly understand that the methods of the above embodiments can be implemented by means of software plus a necessary general-purpose hardware platform, and of course also by hardware, but in many cases the former is better implementation. Based on such an understanding, the technical solution of the present invention can be embodied in the form of a software product in essence or in other words, the part that contributes to the prior art, and the computer software product is stored in a storage medium (such as ROM/RAM) as described above. , magnetic disk, optical disk), including several instructions to make a malicious code visualization and variation detection device (which can be a mobile phone, computer, server, or network equipment, etc.) execute the method described in each embodiment of the present invention. 以上仅为本发明的优选实施例，并非因此限制本发明的专利范围，凡是利用本发明说明书及附图内容所作的等效结构或等效流程变换，或直接或间接运用在其他相关的技术领域，均同理包括在本发明的专利保护范围内。The above are only preferred embodiments of the present invention, and are not intended to limit the patent scope of the present invention. Any equivalent structure or equivalent process conversion made by using the description of the present invention and the contents of the accompanying drawings, or directly or indirectly used in other related technical fields , are all included in the scope of patent protection of the present invention in the same way.

### Claims

Claims (8) Translated from Chinese 1.一种恶意代码可视化及变种检测方法，其特征在于，所述恶意代码可视化及变种检测方法包括：1. A kind of malicious code visualization and variant detection method, it is characterized in that, described malicious code visualization and variant detection method comprise: 获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号；Obtaining the malicious code to be detected, and converting the malicious code into a one-dimensional time series signal; 将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；performing singular spectrum transformation on the one-dimensional time series signal, obtaining the singular transformation spectrum corresponding to the malicious code and outputting it for display; 将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息，其中，所述预设恶意代码分类器是基于恶意代码样本的奇异变换谱训练获得；Inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining family information to which the malicious code belongs, wherein the preset malicious code classifier is based on the singular transformation of malicious code samples Spectrum training obtained; 其中，所述获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号的步骤，包括：Wherein, the steps of obtaining the malicious code to be detected and converting the malicious code into a one-dimensional time series signal include: 获取待检测的恶意代码，及所述恶意代码的二进制可执行文件，将所述二进制可执行文件转换为一维整数数组；Obtain the malicious code to be detected, and the binary executable file of the malicious code, and convert the binary executable file into a one-dimensional integer array; 将所述一维整数数组按照预设采样规则进行下采样，获得一维时间序列信号；Downsampling the one-dimensional integer array according to a preset sampling rule to obtain a one-dimensional time series signal; 所述将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示的步骤，包括：The step of performing singular spectrum transformation on the one-dimensional time series signal to obtain the singular transformation spectrum corresponding to the malicious code and outputting and displaying includes: 将所述一维时间序列信号组合形成时间集合，将所述时间集合转化为预设长度的时间子序列；combining the one-dimensional time series signals to form a time set, and converting the time set into a time subsequence of a preset length; 根据所述时间子序列构造轨迹矩阵，根据所述时间子序列构造测试矩阵，根据所述轨迹矩阵和所述测试矩阵确定变化点分数；Constructing a trajectory matrix according to the time subsequence, constructing a test matrix according to the time subsequence, determining a change point score according to the trajectory matrix and the test matrix; 以所述一维时间序列信号中的时刻为横坐标，以所述变化点分数为纵坐标，获得所述恶意代码对应的奇异变换谱并输出显示。Taking the time in the one-dimensional time series signal as the abscissa and the change point score as the ordinate, obtain the singular transformation spectrum corresponding to the malicious code and output it for display. 2.如权利要求1所述的恶意代码可视化及变种检测方法，其特征在于，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤之前，所述方法包括：2. The malicious code visualization and variant detection method according to claim 1, wherein the singular transformation spectrum corresponding to the malicious code is input to a preset malicious code classifier for variant detection to obtain the malicious code Before the step of belonging to the family information, the method includes: 从预设恶意代码文件数据库中抽取恶意代码样本，将各所述恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；extracting malicious code samples from the preset malicious code file database, performing singular spectrum transformation on each of the malicious code samples, and obtaining a singular transformation spectrum corresponding to each of the malicious code samples; 将各所述奇异变换谱划分形成第一训练集与第一测试集；dividing each singular transformation spectrum to form a first training set and a first test set; 通过所述第一训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；Iteratively training the initial classification algorithm through the singular transformation spectrum in the first training set to obtain a malicious code classifier; 通过所述第一测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code classifier is verified through the first test set to obtain a preset malicious code classifier. 3.如权利要求1所述的恶意代码可视化及变种检测方法，其特征在于，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤，包括：3. The malicious code visualization and variant detection method according to claim 1, wherein the singular transformation spectrum corresponding to the malicious code is input to a preset malicious code classifier for variant detection to obtain the malicious code Steps for belonging family information, including: 将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码的分类结果；Inputting the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtaining the classification result of the malicious code; 在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；When the classification result is the first category, then output the family information of the malicious code; 在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。When the classification result is the second type, it is determined that the malicious code is listed as a new type of malicious code family and output prompt information. 4.如权利要求1所述的恶意代码可视化及变种检测方法，其特征在于，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤之前，所述方法包括：4. The malicious code visualization and variant detection method according to claim 1, wherein the singular transformation spectrum corresponding to the malicious code is input to a preset malicious code classifier for variant detection to obtain the malicious code Before the step of belonging to the family information, the method includes: 将预设恶意代码文件数据库中的恶意代码样本进行奇异谱变换，获得各所述恶意代码样本对应的奇异变换谱；performing singular spectrum transformation on the malicious code samples in the preset malicious code file database to obtain a singular transformation spectrum corresponding to each of the malicious code samples; 从各所述奇异变换谱中提取样本时间序列特征，将各所述样本时间序列特征划分形成第二训练集与第二测试集；extracting sample time series features from each of the singular transformation spectra, and dividing each of the sample time series features to form a second training set and a second test set; 通过所述第二训练集中的奇异变换谱对初始分类算法进行迭代训练，获得恶意代码分类器；Iteratively training the initial classification algorithm through the singular transformation spectrum in the second training set to obtain a malicious code classifier; 通过所述第二测试集对所述恶意代码分类器进行验证，获得预设恶意代码分类器。The malicious code classifier is verified through the second test set to obtain a preset malicious code classifier. 5.如权利要求1至4任意一项所述的恶意代码可视化及变种检测方法，其特征在于，所述将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息的步骤，包括：5. The malicious code visualization and variant detection method according to any one of claims 1 to 4, wherein the singular transformation spectrum corresponding to the malicious code is input to a preset malicious code classifier for variant detection, The step of obtaining the family information to which the malicious code belongs includes: 从所述恶意代码对应的奇异变换谱中提取的待测时间序列特征，将所述待测时间序列特征输入预设恶意代码分类器，获取分类结果；From the time series features to be tested extracted from the singular transformation spectrum corresponding to the malicious code, inputting the time series features to be tested into a preset malicious code classifier to obtain classification results; 在所述分类结果为第一类时，则输出所述恶意代码的所属家族信息；When the classification result is the first category, then output the family information of the malicious code; 在所述分类结果为第二类时，则判定所述恶意代码列为新型恶意代码家族输出提示信息。When the classification result is the second type, it is determined that the malicious code is listed as a new type of malicious code family and output prompt information. 6.一种恶意代码可视化及变种检测装置，其特征在于，所述恶意代码可视化及变种检测装置包括：6. A malicious code visualization and variant detection device, characterized in that, the malicious code visualization and variant detection device comprises: 获取转化模块，用于获取待检测的恶意代码，将所述恶意代码转换为一维时间序列信号；Obtaining a transformation module, configured to obtain malicious codes to be detected, and convert the malicious codes into one-dimensional time series signals; 变化谱生成模块，用于将所述一维时间序列信号进行奇异谱变换，获得所述恶意代码对应的奇异变换谱并输出显示；A variation spectrum generating module, configured to perform singular spectrum transformation on the one-dimensional time series signal, obtain the singular transformation spectrum corresponding to the malicious code and output and display it; 检测确定模块，用于将所述恶意代码对应的奇异变换谱输入至预设恶意代码分类器进行变种检测，获得所述恶意代码所属的家族信息，其中，所述预设恶意代码分类器是基于恶意代码样本的奇异变换谱训练获得；A detection determination module, configured to input the singular transformation spectrum corresponding to the malicious code into a preset malicious code classifier for variant detection, and obtain family information to which the malicious code belongs, wherein the preset malicious code classifier is based on Singular transformation spectrum training of malicious code samples; 所述获取转化模块，还用于获取待检测的恶意代码，及所述恶意代码的二进制可执行文件，将所述二进制可执行文件转换为一维整数数组；将所述一维整数数组按照预设采样规则进行下采样，获得一维时间序列信号；The obtaining conversion module is also used to obtain the malicious code to be detected and the binary executable file of the malicious code, and convert the binary executable file into a one-dimensional integer array; Set the sampling rule for down-sampling to obtain a one-dimensional time series signal; 所述变化谱生成模块，还用于将所述一维时间序列信号组合形成时间集合，将所述时间集合转化为预设长度的时间子序列；根据所述时间子序列构造轨迹矩阵，根据所述时间子序列构造测试矩阵，根据所述轨迹矩阵和所述测试矩阵确定变化点分数；以所述一维时间序列信号中的时刻为横坐标，以所述变化点分数为纵坐标，获得所述恶意代码对应的奇异变换谱并输出显示。The change spectrum generation module is also used to combine the one-dimensional time series signals to form a time set, and convert the time set into a time subsequence of a preset length; construct a trajectory matrix according to the time subsequence, and construct a trajectory matrix according to the time subsequence The time subsequence constructs a test matrix, and determines the change point score according to the trajectory matrix and the test matrix; taking the time in the one-dimensional time series signal as the abscissa, and taking the change point score as the ordinate, the obtained The singular transformation spectrum corresponding to the above malicious code is output and displayed. 7.一种恶意代码可视化及变种检测设备，其特征在于，所述恶意代码可视化及变种检测设备包括：存储器、处理器及存储在所述存储器上并可在所述处理器上运行的恶意代码可视化及变种检测程序，所述恶意代码可视化及变种检测程序被所述处理器执行时实现如权利要求1至5中任一项所述的恶意代码可视化及变种检测方法的步骤。7. A malicious code visualization and variant detection device, characterized in that, the malicious code visualization and variant detection device comprises: a memory, a processor, and malicious code stored on the memory and operable on the processor A visualization and variant detection program, when the malicious code visualization and variant detection program is executed by the processor, the steps of the malicious code visualization and variant detection method according to any one of claims 1 to 5 are realized. 8.一种存储介质，其特征在于，所述存储介质上存储有恶意代码可视化及变种检测程序，所述恶意代码可视化及变种检测程序被处理器执行时实现如权利要求1至5中任一项所述的恶意代码可视化及变种检测方法的步骤。8. A storage medium, characterized in that, a malicious code visualization and variant detection program is stored on the storage medium, and when the malicious code visualization and variant detection program is executed by a processor, any one of claims 1 to 5 is realized. The steps of the malicious code visualization and variant detection method described in the item.
